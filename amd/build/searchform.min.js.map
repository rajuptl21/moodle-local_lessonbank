{"version":3,"file":"searchform.min.js","sources":["../src/searchform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module searchform\n *\n * @module     local_lessonbank/searchform\n * @copyright  2025 Justin Hunt (poodllsupport@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport Log from 'core/log';\nimport loading from 'core/loadingicon';\nimport * as Str from 'core/str';\n\nconst component = 'local_lessonbank';\n\nexport const registerFilter = () => {\n    const form = document.querySelector('#local_lessonbank_filters');\n    const cardsContainer = document.querySelector('[data-region=\"cards-container\"]');\n    const gridlayoutbtn = document.querySelector('.gridlayoutbtn');\n    const listlayoutbtn = document.querySelector('.listlayoutbtn');\n    const countcontainer = document.querySelector('.countcontainer');\n    const pagination = document.querySelector('[name=\"perpageselection\"]');\n\n    gridlayoutbtn?.addEventListener('click', e => {\n        e.preventDefault();\n        cardsContainer.classList.remove('listlayout');\n        gridlayoutbtn.classList.add('active');\n        listlayoutbtn.classList.remove('active');\n        searchFilter(form);\n    });\n    listlayoutbtn?.addEventListener('click', e => {\n        e.preventDefault();\n        cardsContainer.classList.add('listlayout');\n        listlayoutbtn.classList.add('active');\n        gridlayoutbtn.classList.remove('active');\n        searchFilter(form);\n    });\n    const searchFilter = form => {\n        const args = {\n            language: '',\n            level: [],\n            keywords: '',\n            page: 1,\n            perpage: 10\n        };\n        if (form.elements.language) {\n            args.language = form.elements.language.value;\n        }\n        if (form.elements.search) {\n            args.keywords = form.elements.search.value;\n        }\n        if (form.elements['level[]']) {\n            const selectedOptions = form.elements['level[]'].selectedOptions;\n            args.level = Array.from(selectedOptions).map(option => option.value);\n        }\n        if (form.elements.page) {\n            args.page = form.elements.page.value;\n        }\n        if (form.elements.perpage) {\n            args.perpage = form.elements.perpage.value;\n        }\n\n        Ajax.call([{\n            methodname: `${component}_list_minilessons`,\n            args\n        }], true, false)[0]\n        .then(items => {\n            Log.debug(items);\n            items.islistlayot = cardsContainer.classList.contains('listlayout') ? true : false;\n            if (countcontainer) {\n                Str.get_string('foundlessons', 'local_lessonbank', items.totalitems).then((langstr) => {\n                    countcontainer.textContent = langstr;\n                });\n            }\n            Templates.render(`${component}/lessonbankitems`, items)\n            .then((html, js) => {\n                Templates.replaceNodeContents(cardsContainer, html, js);\n            });\n            return null;\n        })\n        .catch(Notification.exception);\n    };\n    form?.addEventListener('submit', e => {\n        e.preventDefault();\n        form.elements.page.value = 1;\n        searchFilter(form);\n    });\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const dirbtn = e.target.closest('[data-action=\"previousbtn\"],[data-action=\"nextbtn\"]');\n        if (dirbtn) {\n            const pageno = dirbtn.getAttribute('data-page');\n            const perpage = dirbtn.getAttribute('data-perpage');\n            const pagevalue = parseInt(pageno, 10) + (dirbtn.dataset.action === 'previousbtn' ? -1: 1);\n            if (form) {\n                form.elements.page.value = pagevalue;\n                form.elements.perpage.value = perpage;\n                searchFilter(form);\n            }\n        }\n\n        const downloadbtn = e.target.closest('[data-action=\"download\"]');\n        if (downloadbtn) {\n            if (!downloadbtn.dataset.id) {\n                return;\n            }\n            const promise = loading.addIconToContainerWithPromise(downloadbtn);\n            Ajax.call([{\n                methodname: `${component}_fetch_minilesson`,\n                args: {\n                    id: Number(downloadbtn.dataset.id)\n                }\n            }], true, false)[0]\n            .then(data => {\n                promise.resolve();\n                const blob = new Blob([data.json], { type: 'application/json' });\n                const url = URL.createObjectURL(blob);\n                e.target.href = url;\n                e.target.download = `${e.target.dataset.download}.json`;\n                e.target.click();\n                e.target.removeAttribute('href');\n                URL.revokeObjectURL(url);\n            }).catch(e => {\n                promise.reject();\n                Notification.exception(e);\n            });\n        }\n        const showtextbtn = e.target.closest('[data-action=\"showtext\"]');\n        if (showtextbtn) {\n            const wrapper = showtextbtn.parentElement;\n            const titlehtml = wrapper.firstElementChild.cloneNode(true).outerHTML;\n            wrapper.innerHTML = titlehtml + wrapper.dataset.text;\n        }\n    });\n    if (pagination) {\n        pagination.addEventListener('change', e => {\n            const perpagevalue = e.target.value;\n            if (form) {\n                form.elements.page.value = 1;\n                form.elements.perpage.value = perpagevalue;\n                searchFilter(form);\n            }\n        });\n    }\n    if (form) {\n        searchFilter(form);\n        if (form.elements.submit) {\n            form.elements.submit.parentElement.classList.add('d-none');\n            form.elements.submit.classList.add('rounded-right');\n            form.elements.search.insertAdjacentElement('afterend', form.elements.submit);\n            form.elements.search.parentElement.classList.add('input-group');\n        }\n    }\n};"],"names":["form","document","querySelector","cardsContainer","gridlayoutbtn","listlayoutbtn","countcontainer","pagination","addEventListener","e","preventDefault","classList","remove","add","searchFilter","args","language","level","keywords","page","perpage","elements","value","search","selectedOptions","Array","from","map","option","call","methodname","then","items","debug","islistlayot","contains","Str","get_string","totalitems","langstr","textContent","render","html","js","replaceNodeContents","catch","Notification","exception","target","href","dirbtn","closest","pageno","getAttribute","pagevalue","parseInt","dataset","action","downloadbtn","id","promise","loading","addIconToContainerWithPromise","Number","data","resolve","blob","Blob","json","type","url","URL","createObjectURL","download","click","removeAttribute","revokeObjectURL","reject","showtextbtn","wrapper","parentElement","titlehtml","firstElementChild","cloneNode","outerHTML","innerHTML","text","perpagevalue","submit","insertAdjacentElement"],"mappings":"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"}